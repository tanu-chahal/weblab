<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clipboard Permission Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .write-btn {
            background-color: #007bff;
            color: white;
        }
        .write-btn:hover {
            background-color: #0056b3;
        }
        .read-btn {
            background-color: #28a745;
            color: white;
        }
        .read-btn:hover {
            background-color: #1e7e34;
        }
        .check-btn {
            background-color: #6c757d;
            color: white;
        }
        .check-btn:hover {
            background-color: #545b62;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .input-group {
            margin: 20px 0;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        .note {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ffeaa7;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Clipboard Permission Demo</h1>
        
        <div class="note">
            <strong>Note:</strong> This demo shows how clipboard permissions work in modern browsers. 
            When you first try to write to the clipboard, the browser will ask for permission.
        </div>

        <div class="input-group">
            <label for="textInput">Text to copy to clipboard:</label>
            <input type="text" id="textInput" placeholder="Enter text to copy..." value="Hello, this is a clipboard test!">
        </div>

        <div class="button-group">
            <button class="write-btn" onclick="writeToClipboard()">
                üìù Copy Text to Clipboard (Triggers Permission)
            </button>
            
            <button class="read-btn" onclick="readFromClipboard()">
                üìñ Read from Clipboard
            </button>
            
            <button class="check-btn" onclick="checkClipboardPermission()">
                üîç Check Clipboard Permission Status
            </button>
        </div>

        <div id="status"></div>
    </div>

    <script>
        // Browser detection
        function getBrowserInfo() {
            const userAgent = navigator.userAgent;
            const isFirefox = userAgent.includes('Firefox');
            const isSafari = userAgent.includes('Safari') && !userAgent.includes('Chrome');
            const isChrome = userAgent.includes('Chrome') && !userAgent.includes('Edge');
            const isEdge = userAgent.includes('Edge') || userAgent.includes('Edg');
            
            return { isFirefox, isSafari, isChrome, isEdge };
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message.replace(/\n/g, '<br>');
            statusDiv.style.display = 'block';
        }

        // Fallback clipboard write for older browsers
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                return successful;
            } catch (err) {
                document.body.removeChild(textArea);
                throw err;
            }
        }

        async function writeToClipboard() {
            const browser = getBrowserInfo();
            const text = document.getElementById('textInput').value;
            
            if (!text.trim()) {
                showStatus('Please enter some text to copy!', 'error');
                return;
            }

            let browserName = browser.isFirefox ? 'Firefox' : 
                             browser.isSafari ? 'Safari' : 
                             browser.isChrome ? 'Chrome' : 
                             browser.isEdge ? 'Edge' : 'Unknown';

            try {
                // Try modern Clipboard API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(text);
                    showStatus(`‚úÖ [${browserName}] Successfully copied "${text}" to clipboard using Clipboard API!`, 'success');
                } else {
                    // Fallback for browsers without Clipboard API
                    const success = fallbackCopyToClipboard(text);
                    if (success) {
                        showStatus(`‚úÖ [${browserName}] Successfully copied "${text}" to clipboard using fallback method!`, 'success');
                    } else {
                        throw new Error('Fallback copy failed');
                    }
                }
            } catch (err) {
                console.error('Failed to copy: ', err);
                
                let errorMessage = `‚ùå [${browserName}] `;
                
                if (err.name === 'NotAllowedError') {
                    if (browser.isFirefox) {
                        errorMessage += 'Clipboard permission denied. Firefox may require user interaction or site to be in allow list.';
                    } else if (browser.isSafari) {
                        errorMessage += 'Clipboard permission denied. Safari requires explicit user permission and secure context.';
                    } else {
                        errorMessage += 'Clipboard permission denied. Please allow clipboard access and try again.';
                    }
                } else if (err.name === 'NotSupportedError') {
                    errorMessage += 'Clipboard API not supported. ';
                    if (browser.isSafari) {
                        errorMessage += 'Safari may require newer version or secure context.';
                    } else if (browser.isFirefox) {
                        errorMessage += 'Firefox may require enabling clipboard permissions in about:config.';
                    }
                } else {
                    errorMessage += `Failed to copy to clipboard: ${err.message}`;
                }
                
                showStatus(errorMessage, 'error');
            }
        }

        async function readFromClipboard() {
            const browser = getBrowserInfo();
            let browserName = browser.isFirefox ? 'Firefox' : 
                             browser.isSafari ? 'Safari' : 
                             browser.isChrome ? 'Chrome' : 
                             browser.isEdge ? 'Edge' : 'Unknown';

            try {
                if (navigator.clipboard && navigator.clipboard.readText) {
                    const text = await navigator.clipboard.readText();
                    showStatus(`üìñ [${browserName}] Clipboard content: "${text}"`, 'success');
                } else {
                    throw new Error('Clipboard read not supported');
                }
            } catch (err) {
                console.error('Failed to read: ', err);
                
                let errorMessage = `‚ùå [${browserName}] `;
                
                if (err.name === 'NotAllowedError') {
                    if (browser.isFirefox) {
                        errorMessage += 'Clipboard read permission denied. Firefox requires explicit permission for reading.';
                    } else if (browser.isSafari) {
                        errorMessage += 'Clipboard read permission denied. Safari requires user gesture and permission.';
                    } else {
                        errorMessage += 'Clipboard read permission denied.';
                    }
                } else if (err.name === 'NotSupportedError' || err.message.includes('not supported')) {
                    if (browser.isSafari) {
                        errorMessage += 'Clipboard read not supported in this Safari version.';
                    } else if (browser.isFirefox) {
                        errorMessage += 'Clipboard read may not be enabled in Firefox.';
                    } else {
                        errorMessage += 'Clipboard read not supported.';
                    }
                } else {
                    errorMessage += `Failed to read from clipboard: ${err.message}`;
                }
                
                showStatus(errorMessage, 'error');
            }
        }

        async function checkClipboardPermission() {
            const browser = getBrowserInfo();
            let browserName = browser.isFirefox ? 'Firefox' : 
                             browser.isSafari ? 'Safari' : 
                             browser.isChrome ? 'Chrome' : 
                             browser.isEdge ? 'Edge' : 'Unknown';

            try {
                let statusMessage = `üîç [${browserName}] Permission Status:<br>`;
                
                // Check if Permissions API is supported
                if (!navigator.permissions) {
                    statusMessage += `Permissions API not supported in ${browserName}.<br>`;
                    statusMessage += 'Permission status cannot be checked programmatically.';
                    showStatus(statusMessage, 'info');
                    return;
                }

                try {
                    const writePermission = await navigator.permissions.query({ name: 'clipboard-write' });
                    statusMessage += `Write: ${writePermission.state}<br>`;
                } catch (writeErr) {
                    if (browser.isFirefox) {
                        statusMessage += `Write: Not queryable in Firefox<br>`;
                    } else if (browser.isSafari) {
                        statusMessage += `Write: Not queryable in Safari<br>`;
                    } else {
                        statusMessage += `Write: Query failed (${writeErr.message})<br>`;
                    }
                }

                try {
                    const readPermission = await navigator.permissions.query({ name: 'clipboard-read' });
                    statusMessage += `Read: ${readPermission.state}<br>`;
                } catch (readErr) {
                    if (browser.isFirefox) {
                        statusMessage += `Read: Not queryable in Firefox<br>`;
                    } else if (browser.isSafari) {
                        statusMessage += `Read: Not queryable in Safari<br>`;
                    } else {
                        statusMessage += `Read: Query failed (${readErr.message})<br>`;
                    }
                }

                // Add browser-specific notes
                if (browser.isFirefox) {
                    statusMessage += `<br><strong>Firefox Note:</strong> Clipboard permissions are handled differently. `;
                    statusMessage += `Permission popups appear when attempting clipboard operations.`;
                } else if (browser.isSafari) {
                    statusMessage += `<br><strong>Safari Note:</strong> Clipboard access requires user gesture and `;
                    statusMessage += `may not show traditional permission popups in all versions.`;
                }
                
                showStatus(statusMessage, 'info');
            } catch (err) {
                let errorMessage = `‚ùå [${browserName}] Could not check clipboard permissions: ${err.message}`;
                if (browser.isFirefox) {
                    errorMessage += '<br>Firefox handles clipboard permissions internally.';
                } else if (browser.isSafari) {
                    errorMessage += '<br>Safari may not support permission queries.';
                }
                showStatus(errorMessage, 'error');
            }
        }

        // Initialize and show browser info
        function initializePage() {
            const browser = getBrowserInfo();
            let browserName = browser.isFirefox ? 'Firefox' : 
                             browser.isSafari ? 'Safari' : 
                             browser.isChrome ? 'Chrome' : 
                             browser.isEdge ? 'Edge' : 'Unknown';

            // Check if the Clipboard API is supported
            if (!navigator.clipboard) {
                showStatus(`‚ùå [${browserName}] Clipboard API is not supported. Try using HTTPS or a modern browser.`, 'error');
                return;
            }

            // Inform user about HTTPS requirement
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                showStatus(`‚ö†Ô∏è [${browserName}] Clipboard API requires HTTPS to work properly.`, 'error');
                return;
            }

            // Show initial browser info
            let initMessage = `üåê Detected Browser: ${browserName}<br>`;
            initMessage += `üìã Clipboard API: ${navigator.clipboard ? 'Supported' : 'Not Supported'}<br>`;
            
            if (browser.isFirefox) {
                initMessage += `<br><strong>Firefox:</strong> May require user interaction for clipboard access.`;
            } else if (browser.isSafari) {
                initMessage += `<br><strong>Safari:</strong> Requires secure context and user gestures for clipboard access.`;
            }
            
            showStatus(initMessage, 'info');
        }

        // Initialize when page loads
        window.addEventListener('load', initializePage);
    </script>
</body>
</html>